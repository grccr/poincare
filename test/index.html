<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Poincare</title>
  <style type="text/css">
    html, body {
      padding: 0;
      margin: 0;
    }
    a {
      position: absolute;
      top: 50px;
      left: 50px;
      display: inline-block;
      color: white;
      background-color: black;
      border: 2px solid white;
      padding: 3px;
    }
  </style>
</head>
<body>
  <div class="graph" id="ashberry" style="width: 100%; height: 100%; position: absolute;"></div>
  <a href="#" onclick="stop()">STOP</a>
  <script src="/dist/poincare.js"></script>
  <script>
  function stop() {
    PN.stop();
  }

  if (poincare.env == 'production' || poincare.env == 'stage') {
    var pn = new poincare.Poincare({
      container: '.graph',
      zoom: {
        min: 0.1,
        max: 60
      },
      transparent: true,
      directions: {
        show: true,
        style: 'acute', // 'acute', 'tapered', 'expanded'
        size: [6, 8] // [width, height]
      },
      nodes: {
        radius: 16
      },
      links: {
        color: (link) => {
          return link.data.color || '#CCC';
        }
      },
      labels: {
        getter: (d) => { return d.name; }
      },
      icons: {
        source: '/assets/icons/electric-icon.png',
        size: 16
      },
      physics: {
        // stableThreshold: 0.001
        springLength: 100,
        stableThreshold: 100
      },
      plugins: [
        poincare.plugins.AutoResize, 
        poincare.plugins.Events, 
        poincare.plugins.Lighter, 
        poincare.plugins.Labels, 
        poincare.plugins.Cursors, 
        poincare.plugins.Directions
      ]
    });
    pn.on('zoom:start', () => console.debug('zoomstart'));
    pn.on('zoom:stop', () => console.debug('zoomend'));
    pn.on('view:reset', () => console.debug('viewreset'));
    pn.on('core:run', () => console.debug('run'));
    pn.on('layout:ready', () => console.debug('layoutstop'));
    pn.on('zoom:change', () => console.debug('zoom'));
    
    pn.on('node:tip:hover', id => {
      const labels = pn.plugins.labels;
      labels && labels.highlight([id]);
    });
    pn.on('node:over', (id) => {
      const lighter = pn.plugins.lighter;
      lighter && lighter.lightNodes([id]);
      console.debug('Node over', id);
    });
    pn.on('node:out', (id) => {
      const lighter = pn.plugins.lighter;
      const labels = pn.plugins.labels;
      lighter && lighter.lightNodes([]);
      labels && labels.highlight([]);
      console.debug('Node out', id);
    });
    pn.on('node:click', (id, event) => {
      const item = pn.graph.getNode(id);
      console.debug('Node clicked', id, item, event);
    });
    pn.on('node:menu', (id, event) => {
      const item = pn.graph.getNode(id);
      console.debug('Node menu clicked', id, item, event);
    });
    pn.on('link:click', (id, event) => {
      const item = pn.core.link(id);
      console.debug('Just link clicked', id, item, event);
    });
    pn.on('link:menu', (id, event) => {
      const item = pn.core.link(id);
      console.debug('Link menu clicked', id, item, event);
      return false;
    });
    pn.on('link:tip:hover', (id) => {
      const item = pn.core.link(id);
      const labels = pn.plugins.labels;
      labels && labels.highlight([item.fromId, item.toId]);
    });
    pn.on('link:over', (id) => {
      const item = pn.core.link(id);
      const lighter = pn.plugins.lighter;
      lighter && lighter.lightLinks([id]);
      lighter && lighter.lightNodes([item.fromId, item.toId]);
      console.debug('Link over', id);
    });
    pn.on('link:out', (id) => {
      const lighter = pn.plugins.lighter;
      const labels = pn.plugins.labels;
      lighter && lighter.lightLinks([]);
      lighter && lighter.lightNodes([]);
      labels && labels.highlight([]);
      console.debug('Link out', id);
    });

    var myGraph = {
      nodes: [
        { v: '1', value: { label: 'Капуста' } },
        { v: '2', value: { label: 'Морковка' } }
      ],
      edges: [
        { v: '1', w: '2', value: { label: 3 } }
      ],
      options: { directed: true }
    };

    pn.graph = poincare.parsers.NGraph.fromJSON(myGraph);

    //Window.PN = pn;
    // Примеры API
    pn.on('layout:ready', () => {
      let aNode = pn.createNode('a', {label:'a'});
      pn.updateNode('a', {label: 'new', name:'AA'})
      let bNode = pn.createNode('b', {label:'b'});
      let l = pn.createLink('a', 'b', {label:'ab', dual:true});
      l = pn.updateLink(l.id, {label:'asd', color:'#FF0000', name: 'link'});
      //pn.removeLink(l.id);
    });
  }
  </script>
</body>
</html>